import socket
from struct import unpack
sock = socket.socket(socket.AF_INET,socket.SOCK_RAW,socket.IPPROTO_TCP)
x=sock.recvfrom(65565)
print(x);
while True:
 packet=sock.recvfrom(65565)
 packet=packet[0]

 ip_header=packet[0:20]
 iph=unpack('!BBHHHBBH4s4s', ip_header)

 version_ihl=iph[0]
 version=version_ihl>>4
 ihl= version_ihl & 0xF

 iph_lenght=ihl*4
 ttl=iph[5]
 protocol=iph[6]
 s_addr=socket.inet_ntoa(iph[8]);
 d_addr=socket.inet_ntoa(iph[9]);

 print("Version: " + str(version) + " IP Header: " + str(iph_lenght))

 tcp_header=packet[iph_lenght:iph_lenght+20]
 tcph=unpack('!HHLLBBHHH',tcp_header)


 source_port= tcph[0]
 dest_port= tcph[1]
 sequence=tcph[2]
 acknowledgement=tcph[3]
 doff_reserved=tcph[4]
 tcph_lenght=doff_reserved>>4
 print("Source port: "+str(source_port) + " Destination port:" +str(dest_port))

 h_size=iph_lenght+tcph_lenght*4
 datasize=len(packet)-h_size
 data=packet[h_size:]
 print("data" +str(data))


